/*
 * solar-system
 * @Description Solar System with Threejs
 * @version v0.0.47 - 2015-09-29
 * @link https://github.com/KenEDR/three-solar-system#readme
 * @author Enrique Daimiel Ruiz <k.daimiel@gmail.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
THREE.Clouds=function(a){THREE.Object3D.call(this),this.type=a.type||"Clouds",this.rotation.x=this.tilt,this.geometry=new THREE.SphereGeometry(a.radius,100,100);var b=THREE.ImageUtils.loadTexture(a.map);this.material=new THREE.MeshPhongMaterial({map:b,side:THREE.DoubleSide,opacity:a.opacity,transparent:a.transparent,depthWrite:a.depthWrite}),this.updateMorphTargets()},THREE.Clouds.prototype=Object.create(THREE.Mesh.prototype),THREE.Clouds.prototype.constructor=THREE.Clouds,THREE.Clouds.prototype.update=function(){this.rotation.x-=this.speed*Math.PI/180,this.rotation.y-=this.speed*Math.PI/180,this.rotation.z-=this.speed*Math.PI/180},THREE.Planet=function(a){THREE.SolarBody.call(this,a),a.cloudsProperties&&this.createClouds(a.cloudsProperties),a.ringsProperties&&this.createRings(a.ringsProperties)},THREE.Planet.prototype=Object.create(THREE.SolarBody.prototype),THREE.Planet.prototype.constructor=THREE.Planet,THREE.Planet.prototype.createClouds=function(a){this.add(new THREE.Clouds(a))},THREE.Planet.prototype.createRings=function(a){this.add(new THREE.SolarRings(a))},THREE.Planet.prototype.update=function(a){this.rotation.y-=this.vRotation*Math.PI/180;for(var b in this.children)this.children[b].update(a,this)},THREE.SolarBody=function(a){THREE.Object3D.call(this),this.name=a.name,this.type=a.type,this.radius=a.radius||50,this.rotation.x=a.tilt||0,this.vRotation=a.vRotation||0,this.geometry=new THREE.SphereGeometry(this.radius||50,100,100),this.material=new THREE.MeshPhongMaterial,this.material.map=THREE.ImageUtils.loadTexture(a.map),this.material.bumpMap=void 0!==a.bumpMap?THREE.ImageUtils.loadTexture(a.bumpMap):void 0,this.material.specularMap=void 0!==a.specularMap?THREE.ImageUtils.loadTexture(a.specularMap):void 0,this.updateMorphTargets()},THREE.SolarBody.prototype=Object.create(THREE.Mesh.prototype),THREE.SolarBody.prototype.constructor=THREE.SolarBody,THREE.SolarBody.prototype.addSatellite=function(a,b){var c=new THREE.SolarOrbit(b);a.orbit=c,this.orbit?(this.orbit.add(c),c.position.z=this.position.z||0):this.parent.add(c),c.add(a),a.position.z=this.radius+c.distance+a.radius||0},THREE.SolarOrbit=function(a){THREE.Object3D.call(this),this.type="SolarOrbit",this.distance=a.distance||50,this.speed=a.speed||0,this.tilt=a.tilt||0},THREE.SolarOrbit.prototype=Object.create(THREE.Object3D.prototype),THREE.SolarOrbit.prototype.constructor=THREE.SolarOrbit,THREE.SolarOrbit.prototype.update=function(){this.rotation.y-=this.speed*Math.PI/180;for(var a in this.children)this.children[a].update()},THREE.SolarRings=function(a){THREE.Object3D.call(this),this.type="SolarRings",this.map=a.map,this.vRotation=a.vRotation||0,this.tilt=a.tilt||0,this.geometry=new THREE.RingsGeometry(a);var b=THREE.ImageUtils.loadTexture(this.map);this.material=new THREE.MeshPhongMaterial({map:b,side:THREE.DoubleSide}),this.rotation.x=(90-this.tilt)*Math.PI/180},THREE.SolarRings.prototype=Object.create(THREE.Mesh.prototype),THREE.SolarRings.prototype.constructor=THREE.SolarRings,THREE.SolarRings.prototype.update=function(){this.rotation.y-=this.vRotation*Math.PI/180},THREE.RingsGeometry=function(a){THREE.Geometry.call(this),this.type="RingsGeometry",this.innerRadius=a.innerRadius||0,this.outerRadius=a.outerRadius||50,this.thetaStart=void 0!==a.thetaStart?a.thetaStart:0,this.thetaLength=void 0!==a.thetaLength?a.thetaLength:2*Math.PI,this.thetaSegments=void 0!==a.thetaSegments?Math.max(3,a.thetaSegments):50,this.phiSegments=void 0!==a.phiSegments?Math.max(1,a.phiSegments):50;var b,c,d,e=[],f=this.innerRadius,g=(a.outerRadius-a.innerRadius)/this.phiSegments;for(b=0;b<this.phiSegments+1;b++){for(c=0;c<this.thetaSegments+1;c++){var h=new THREE.Vector3;d=this.thetaStart+c/this.thetaSegments*this.thetaLength,h.x=f*Math.cos(d),h.y=f*Math.sin(d),this.vertices.push(h),e.push(new THREE.Vector2(b/(this.thetaSegments-1),c/(this.phiSegments-1)))}f+=g}var i=new THREE.Vector3(0,0,1);for(b=0;b<this.phiSegments;b++){var j=b*(this.thetaSegments+1);for(c=0;c<this.thetaSegments;c++){d=c+j;var k=d,l=d+this.thetaSegments+1,m=d+this.thetaSegments+2;this.faces.push(new THREE.Face3(k,l,m,[i.clone(),i.clone(),i.clone()])),this.faceVertexUvs[0].push([e[k].clone(),e[l].clone(),e[m].clone()]),k=d,l=d+this.thetaSegments+2,m=d+1,this.faces.push(new THREE.Face3(k,l,m,[i.clone(),i.clone(),i.clone()])),this.faceVertexUvs[0].push([e[k].clone(),e[l].clone(),e[m].clone()])}}this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,f)},THREE.RingsGeometry.prototype=Object.create(THREE.RingGeometry.prototype),THREE.RingsGeometry.prototype.constructor=THREE.RingsGeometry,require(["scene-factory","solar-service"],function(a,b){function c(){a.init(),b.getCameras(g),b.getBodies(h),b.getLights(i)}function d(b){var c;switch(b.type){case"Star":c=new THREE.Star(b);break;case"Planet":c=new THREE.Planet(b);break;case"Dwarf Planet":c=new THREE.Planet(b);break;case"Moon":c=new THREE.Planet(b);break;default:return void console.error(b.type+" is not considered a kind of solar body")}j[c.name]=c,b.orbitProperties?j[b.orbitProperties.round].addSatellite(c,b.orbitProperties):a.addObject(c)}function e(b){var c;switch(b.aspect=b.aspect||window.innerWidth/window.innerHeight,b.type){case"PerspectiveCamera":c=new THREE.PerspectiveCamera(b.fov,b.aspect,b.near,b.far);break;case"CubeCamera":c=new THREE.CubeCamera(b.near,b.far,b.cubeResolution);break;case"OrthographicCamera":c=new THREE.OrthographicCamera(b.left,b.right,b.top,b.bottom,b.near,b.far);break;default:return void console.error(b.type+" is not a kind of valid camera")}b.position&&(c.position.x=b.position.x||0,c.position.y=b.position.y||0,c.position.z=b.position.z||0),c.zoom=b.zoom||1,a.setCamera(c),a.animate();var d;switch(b.controls){case"TrackballControls":d=new THREE.TrackballControls(c);break;case"DeviceOrientationControls":d=new THREE.DeviceOrientationControls(c);break;case"FlyControls":d=new THREE.FlyControls(c);break;case"OrbitControls":d=new THREE.OrbitControls(c);break;case"PointerLockControls":d=new THREE.PointerLockControls(c);break;case"TransformControls":d=new THREE.TransformControls(c);break;default:return void console.error(b.controls+" is not a kind of valid camera controls")}a.setControls(d)}function f(b){var c,d=new THREE.Color(b.hexColor)||16777215;switch(b.type){case"AmbientLight":c=new THREE.AmbientLight(d);break;case"DirectionalLight":c=new THREE.DirectionalLight(d,b.intensity||.5);break;case"PointLight":c=new THREE.PointLight(d,b.intensity||1,b.distance||0,b.decay||1);break;case"SpotLight":c=new THREE.SpotLight(d,b.intensity||1,b.distance||0,b.angle||Math.PI/3,b.exponent||10,b.decay||1);break;default:return void console.error(b.type+" is not a kind of valid light")}b.position&&c.position.set(b.position.x||0,b.position.y||0,b.position.z||0),c.onlyShadow=b.onlyShadow||!1,c.castShadow=b.castShadow||!1,c.shadowCameraNear=b.shadowCameraNear||50,c.shadowCameraFar=b.shadowCameraFar||5e3,c.shadowCameraLeft=b.shadowCameraLeft||-500,c.shadowCameraRight=b.shadowCameraRight||500,c.shadowCameraTop=b.shadowCameraTop||500,c.shadowCameraBottom=b.shadowCameraBottom||-500,c.shadowCameraVisible=b.shadowCameraVisible||!1,c.shadowBias=b.shadowBias||0,c.shadowDarkness=b.shadowDarkness||.5,c.shadowMapWidth=b.shadowMapWidth||512,c.shadowMapWidth=b.shadowMapHeight||512,c.shadowMapSize=b.shadowMapSize,c.shadowCamera=b.shadowCamera,c.shadowMatrix=b.shadowMatrix,c.shadowMap=b.shadowMap,a.addObject(c)}function g(a){a.forEach(function(a){e(a)})}function h(a){a.forEach(function(a){d(a)})}function i(a){a.forEach(function(a){f(a)})}var j={};c()}),THREE.Star=function(a){THREE.SolarBody.call(this,a),this.material.depthWrite=!1;var b=new THREE.PointLight(16777215,1);b.update=function(a){for(var c in b.children)b.children[c].update&&b.children[c].update(a)},this.add(b),this.updateMorphTargets()},THREE.Star.prototype=Object.create(THREE.SolarBody.prototype),THREE.Star.prototype.constructor=THREE.Star,THREE.Star.prototype.update=function(a){this.rotation.y-=this.vRotation*Math.PI/180,!this.hasLensFlare;for(var b in this.children)this.children[b].update(a,this)},THREE.Star.prototype.createLensFlare=function(a){var b=a.position.distanceTo(this.position),c=2*this.radius,d=20*Math.atan(c/(2*b))*(180/Math.PI),e=new THREE.Color(16777215);e.offsetHSL(.08,.5,.5);var f=THREE.ImageUtils.loadTexture("img/sun/lensflare1.png"),g=THREE.ImageUtils.loadTexture("img/sun/lensflare2.png"),h=THREE.ImageUtils.loadTexture("img/sun/lensflare3.png"),i=THREE.ImageUtils.loadTexture("img/sun/lensflare4.png"),j=new THREE.LensFlare(f,16*d,0,THREE.AdditiveBlending,e);j.add(g,17*d,0,THREE.AdditiveBlending),j.add(h,20*d,0,THREE.AdditiveBlending),j.add(i,48*d,0,THREE.AdditiveBlending),j.position=this.position,j.size=d,j.update=function(a,b){var c,d,e=this.lensFlares.length,f=2*b.radius,g=a.position.distanceTo(b.position);for(c=0;e>c;c++)d=this.lensFlares[c],d.pisition=b.position,d.scale=f/g},this.add(j),this.hasLensFlare=!0},define("scene-factory",function(){"use strict";function a(a){g.add(a)}function b(a){h=a}function c(a){j=a,j.addEventListener("change",d)}function d(){i.render(g,h)}function e(){g=new THREE.Scene,i=new THREE.WebGLRenderer({alpha:!0}),i.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(i.domElement)}function f(){requestAnimationFrame(f);for(var a in g.children)g.children[a].update&&g.children[a].update(h);j&&j.update(),d()}var g,h,i,j,k={addObject:a,animate:f,setCamera:b,setControls:c,init:e};return k}),define("solar-service",function(){"use strict";function a(a){d("../src/data/cameras.properties.json",a)}function b(a){d("../src/data/bodies.properties.json",a)}function c(a){d("../src/data/lights.properties.json",a)}function d(a,b){$.ajax(a,{success:function(a){return b(a)},error:function(b){console.error("Load "+a+" error :"+b)}})}var e={getCameras:a,getBodies:b,getLights:c};return e});